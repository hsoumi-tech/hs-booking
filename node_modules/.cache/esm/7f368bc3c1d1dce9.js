let mongoose,RoomType,BedType,Room,Hotel;_c1d‍.x([["getRoomTypeById",()=>getRoomTypeById],["getAllRoomTypes",()=>getAllRoomTypes],["addRoomType",()=>addRoomType],["updateRoomType",()=>updateRoomType],["deleteRoomType",()=>deleteRoomType],["getBedTypeById",()=>getBedTypeById],["getAllBedTypes",()=>getAllBedTypes],["addBedType",()=>addBedType],["updateBedType",()=>updateBedType],["deleteBedType",()=>deleteBedType],["getRoomById",()=>getRoomById],["getAllRooms",()=>getAllRooms],["addRoom",()=>addRoom],["updateRoom",()=>updateRoom],["deleteRoom",()=>deleteRoom],["getHotelById",()=>getHotelById],["getAllHotels",()=>getAllHotels],["addHotel",()=>addHotel],["updateHotel",()=>updateHotel],["deleteHotel",()=>deleteHotel]]);_c1d‍.w("mongoose",[["default",["mongoose"],function(v){mongoose=v}]]);_c1d‍.w("../models/roomType",[["default",["RoomType"],function(v){RoomType=v}]]);_c1d‍.w("../models/bedType",[["default",["BedType"],function(v){BedType=v}]]);_c1d‍.w("../models/room",[["default",["Room"],function(v){Room=v}]]);_c1d‍.w("../models/hotel",[["default",["Hotel"],function(v){Hotel=v}]]);






// ###############################################################################
// ### room type
// ###############################################################################

       const getRoomTypeById = async (id) => {
  if (mongoose.Types.ObjectId.isValid(id) === false) {
    return {
      code: 422,
      message: 'invalid room type id'
    };
  }
  return RoomType.findOne({
    _id: id
  })
};

       const getAllRoomTypes = () => {
  return RoomType.find({})
};

       const addRoomType = async ({
  name,
  description
}) => {

  return new RoomType({
    name,
    description
  }).save()
};


       const updateRoomType = async ({
  name,
  description,
  id
}) => {
  if (mongoose.Types.ObjectId.isValid(id) === false) {
    return {
      code: 422,
      message: 'invalid room type id'
    };
  }

  let roomType = await RoomType.findOne({
    _id: id
  })

  if (roomType) {
    roomType.name = name ? name : roomType.name;
    roomType.description = description ? description : roomType.description

    return roomType.save()
  } else {
    return {
      code: 404,
      message: 'room type not found'
    };
  }
};

       const deleteRoomType = async (id) => {
  if (mongoose.Types.ObjectId.isValid(id) === false) {
    return {
      code: 422,
      message: 'invalid room type id'
    };
  }
  return RoomType.findOneAndDelete({
    _id: id
  })
};

// ###############################################################################
// ### bed type
// ###############################################################################

       const getBedTypeById = async (id) => {
  if (mongoose.Types.ObjectId.isValid(id) === false) {
    return {
      code: 422,
      message: 'invalid bed type id'
    };
  }
  return BedType.findOne({
    _id: id
  })
};

       const getAllBedTypes = () => {
  return BedType.find({})
};

       const addBedType = async ({
  name,
  description,
  size
}) => {

  return new BedType({
    name,
    description,
    size
  }).save()
};


       const updateBedType = async ({
  name,
  description,
  size,
  id
}) => {
  if (mongoose.Types.ObjectId.isValid(id) === false) {
    return {
      code: 422,
      message: 'invalid bed type id'
    };
  }

  let bedType = await BedType.findOne({
    _id: id
  })

  if (bedType) {
    bedType.name = name ? name : bedType.name;
    bedType.description = description ? description : bedType.description
    bedType.size = size ? size : bedType.size

    return bedType.save()
  } else {
    return {
      code: 404,
      message: 'bed type not found'
    };
  }
};

       const deleteBedType = async (id) => {
  if (mongoose.Types.ObjectId.isValid(id) === false) {
    return {
      code: 422,
      message: 'invalid bed type id'
    };
  }
  return BedType.findOneAndDelete({
    _id: id
  })
};

// ###############################################################################
// ### room
// ###############################################################################


       const getRoomById = async (id) => {
  if (mongoose.Types.ObjectId.isValid(id) === false) {
    return {
      code: 422,
      message: 'invalid room id'
    };
  }
  return Room.findOne({
    _id: id
  })
};

       const getAllRooms = () => {
  return Room.find({})
};

       const addRoom = async ({
  hotel,
  roomType,
  beds,
  occupancy,
  floorLevel,
  roomNumber,
  pricePerNight
}) => {

  if (mongoose.Types.ObjectId.isValid(hotel) === false) {
    return {
      code: 422,
      message: 'invalid hotel id'
    };
  } else if (!await Hotel.findOne({
      _id: hotel
    })) {
    return {
      code: 404,
      message: 'hotel not found'
    };
  }

  if (mongoose.Types.ObjectId.isValid(roomType) === false) {
    return {
      code: 422,
      message: 'invalid roomType id'
    };
  } else if (!await RoomType.findOne({
      _id: roomType
    })) {
    return {
      code: 404,
      message: 'room type not found'
    };
  }

  for (let i = 0; i < beds.length; i++) {
    if (mongoose.Types.ObjectId.isValid(beds[i]) === false) {
      return {
        code: 422,
        message: `invalid bed id`
      };
    } else if (!await BedType.findOne({
        _id: beds[i]
      })) {
      return {
        code: 404,
        message: 'bed type not found'
      };
    }
  };


  return new Room({
    hotel,
    roomType,
    beds,
    occupancy,
    floorLevel,
    roomNumber,
    pricePerNight
  }).save()
};


       const updateRoom = async ({
  hotel,
  roomType,
  beds,
  occupancy,
  floorLevel,
  roomNumber,
  pricePerNight,
  id
}) => {

  if (mongoose.Types.ObjectId.isValid(id) === false) {
    return {
      code: 422,
      message: 'invalid room id'
    };
  }

  let room = await Room.findOne({
    _id: id
  })

  if (room) {
    if (hotel) {
      if (mongoose.Types.ObjectId.isValid(hotel) === false) {
        return {
          code: 422,
          message: 'invalid hotel id'
        };
      } else if (!await Hotel.findOne({
          _id: hotel
        })) {
        return {
          code: 404,
          message: 'hotel not found'
        };
      }
    }

    if (roomType) {
      if (mongoose.Types.ObjectId.isValid(roomType) === false) {
        return {
          code: 422,
          message: 'invalid roomType id'
        };
      } else if (!await RoomType.findOne({
          _id: roomType
        })) {
        return {
          code: 404,
          message: 'room type not found'
        };
      }
    }

    if (beds) {
      beds.forEach(async (bed, i) => {
        if (mongoose.Types.ObjectId.isValid(bed) === false) {
          return {
            code: 422,
            message: `invalid beds[${i}] id`
          };
        } else if (!await BedType.findOne({
            _id: bed
          })) {
          return {
            code: 404,
            message: 'bed type not found'
          };
        }
      });
    }

    room.hotel = hotel ? hotel : room.hotel;
    room.roomType = roomType ? roomType : room.roomType;
    room.beds = beds ? beds : room.beds
    room.occupancy = occupancy ? occupancy : room.occupancy
    room.floorLevel = floorLevel ? floorLevel : room.floorLevel
    room.roomNumber = roomNumber ? roomNumber : room.roomNumber
    room.pricePerNight = pricePerNight ? pricePerNight : room.pricePerNight

    return room.save()
  } else {
    return {
      code: 404,
      message: 'room not found'
    };
  }
};

       const deleteRoom = async (id) => {
  if (mongoose.Types.ObjectId.isValid(id) === false) {
    return {
      code: 422,
      message: 'invalid room id'
    };
  }
  return Room.findOneAndDelete({
    _id: id
  })
};

// ###############################################################################
// ### hotel
// ###############################################################################


       const getHotelById = async (id) => {
  if (mongoose.Types.ObjectId.isValid(id) === false) {
    return {
      code: 422,
      message: 'invalid hotel id'
    };
  }
  return Hotel.findOne({
    _id: id
  })
};

       const getAllHotels = () => {
  return Hotel.find({})
};

       const addHotel = async ({
  name,
  description,
  adress,
  phoneNumber
}) => {




  return new Hotel({
    name,
    description,
    adress,
    phoneNumber
  }).save()
};


       const updateHotel = async ({
  name,
  description,
  adress,
  phoneNumber,
  id
}) => {

  if (mongoose.Types.ObjectId.isValid(id) === false) {
    return {
      code: 422,
      message: 'invalid hotel id'
    };
  }

  let hotel = await Hotel.findOne({
    _id: id
  })

  if (hotel) {
    hotel.name = name ? name : hotel.name;
    hotel.description = description ? description : hotel.description
    hotel.adress = adress ? adress : hotel.adress
    hotel.phoneNumber = phoneNumber ? phoneNumber : hotel.phoneNumber

    return hotel.save()
  } else {
    return {
      code: 404,
      message: 'hotel not found'
    };
  }
};

       const deleteHotel = async (id) => {
  if (mongoose.Types.ObjectId.isValid(id) === false) {
    return {
      code: 422,
      message: 'invalid hotel id'
    };
  }
  return Hotel.findOneAndDelete({
    _id: id
  })
};