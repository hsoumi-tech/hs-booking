let mongoose,RoomType,BedType,Room;_769‍.x([["getRoomTypeById",()=>getRoomTypeById],["getAllRoomTypes",()=>getAllRoomTypes],["addRoomType",()=>addRoomType],["updateRoomType",()=>updateRoomType],["deleteRoomType",()=>deleteRoomType],["getBedTypeById",()=>getBedTypeById],["getAllBedTypes",()=>getAllBedTypes],["addBedType",()=>addBedType],["updateBedType",()=>updateBedType],["deleteBedType",()=>deleteBedType],["getRoomById",()=>getRoomById],["getAllRooms",()=>getAllRooms],["addRoom",()=>addRoom],["updateRoom",()=>updateRoom],["deleteRoom",()=>deleteRoom]]);_769‍.w("mongoose",[["default",["mongoose"],function(v){mongoose=v}]]);_769‍.w("../models/roomType",[["default",["RoomType"],function(v){RoomType=v}]]);_769‍.w("../models/bedType",[["default",["BedType"],function(v){BedType=v}]]);_769‍.w("../models/room",[["default",["Room"],function(v){Room=v}]]);





// ###############################################################################
// ### room type
// ###############################################################################

       const getRoomTypeById = async (id) => {
  if (mongoose.Types.ObjectId.isValid(id) === false) {
    return {
      code: 422,
      message: 'invalid room type id'
    };
  }
  return RoomType.findOne({
    _id: id
  })
};

       const getAllRoomTypes = () => {
  return RoomType.find({})
};

       const addRoomType = async ({
  name,
  description
}) => {

  return new RoomType({
    name,
    description
  }).save()
};


       const updateRoomType = async ({
  name,
  description,
  id
}) => {
  if (mongoose.Types.ObjectId.isValid(id) === false) {
    return {
      code: 422,
      message: 'invalid room type id'
    };
  }

  let roomType = await RoomType.findOne({
    _id: id
  })

  if (roomType) {
    roomType.name = name ? name : roomType.name;
    roomType.description = description ? description : roomType.description

    return roomType.save()
  } else {
    return {
      code: 404,
      message: 'room type not found'
    };
  }
};

       const deleteRoomType = async (id) => {
  if (mongoose.Types.ObjectId.isValid(id) === false) {
    return {
      code: 422,
      message: 'invalid room type id'
    };
  }
  return RoomType.findOneAndDelete({
    _id: id
  })
};

// ###############################################################################
// ### bed type
// ###############################################################################

       const getBedTypeById = async (id) => {
  if (mongoose.Types.ObjectId.isValid(id) === false) {
    return {
      code: 422,
      message: 'invalid bed type id'
    };
  }
  return BedType.findOne({
    _id: id
  })
};

       const getAllBedTypes = () => {
  return BedType.find({})
};

       const addBedType = async ({
  name,
  description,
  size
}) => {

  return new BedType({
    name,
    description,
    size
  }).save()
};


       const updateBedType = async ({
  name,
  description,
  size,
  id
}) => {
  if (mongoose.Types.ObjectId.isValid(id) === false) {
    return {
      code: 422,
      message: 'invalid bed type id'
    };
  }

  let bedType = await BedType.findOne({
    _id: id
  })

  if (bedType) {
    bedType.name = name ? name : bedType.name;
    bedType.description = description ? description : bedType.description
    bedType.size = size ? size : bedType.size

    return bedType.save()
  } else {
    return {
      code: 404,
      message: 'bed type not found'
    };
  }
};

       const deleteBedType = async (id) => {
  if (mongoose.Types.ObjectId.isValid(id) === false) {
    return {
      code: 422,
      message: 'invalid bed type id'
    };
  }
  return BedType.findOneAndDelete({
    _id: id
  })
};

// ###############################################################################
// ### room
// ###############################################################################


       const getRoomById = async (id) => {
  if (mongoose.Types.ObjectId.isValid(id) === false) {
    return {
      code: 422,
      message: 'invalid room id'
    };
  }
  return Room.findOne({
    _id: id
  })
};

       const getAllRooms = () => {
  return Room.find({})
};

// properties: {
//   roomType: {
//     type: 'string'
//   },
//   beds: [{
//     type: 'string'
//   }],
//   occupancy: {
//     type: 'number'
//   },
//   floorLevel: {
//     type: 'number'
//   },
//   roomNumber: {
//     type: 'number'
//   },
//   pricePerNight: {
//     type: 'number'
//   }
// }
       const addRoom = async ({
  roomType,
  beds,
  occupancy,
  floorLevel,
  roomNumber,
  pricePerNight
}) => {


  if (mongoose.Types.ObjectId.isValid(roomType) === false) {
    return {
      code: 422,
      message: 'invalid roomType id'
    };
  } else if (!await RoomType.findOne({
      _id: roomType
    })) {
    return {
      code: 404,
      message: 'room type not found'
    };
  }

  beds.forEach(async (bed, i) => {
    if (mongoose.Types.ObjectId.isValid(bed) === false) {
      return {
        code: 422,
        message: `invalid beds[${i}] id`
      };
    } else if (!await BedType.findOne({
        _id: bed
      })) {
      return {
        code: 404,
        message: 'bed type not found'
      };
    }
  });

  return new Room({
    roomType,
    beds,
    occupancy,
    floorLevel,
    roomNumber,
    pricePerNight
  }).save()
};


       const updateRoom = async ({
  roomType,
  beds,
  occupancy,
  floorLevel,
  roomNumber,
  pricePerNight,
  id
}) => {

  if (mongoose.Types.ObjectId.isValid(id) === false) {
    return {
      code: 422,
      message: 'invalid room id'
    };
  }

  let room = await Room.findOne({
    _id: id
  })

  if (room) {
    if (roomType) {
      if (mongoose.Types.ObjectId.isValid(roomType) === false) {
        return {
          code: 422,
          message: 'invalid roomType id'
        };
      } else if (!await RoomType.findOne({
          _id: roomType
        })) {
        return {
          code: 404,
          message: 'room type not found'
        };
      }
    }

    if (beds) {
      beds.forEach(async (bed, i) => {
        if (mongoose.Types.ObjectId.isValid(bed) === false) {
          return {
            code: 422,
            message: `invalid beds[${i}] id`
          };
        } else if (!await BedType.findOne({
            _id: bed
          })) {
          return {
            code: 404,
            message: 'bed type not found'
          };
        }
      });
    }

    room.roomType = roomType ? roomType : room.roomType;
    room.beds = beds ? beds : room.beds
    room.occupancy = occupancy ? occupancy : room.occupancy
    room.floorLevel = floorLevel ? floorLevel : room.floorLevel
    room.roomNumber = roomNumber ? roomNumber : room.roomNumber
    room.pricePerNight = pricePerNight ? pricePerNight : room.pricePerNight

    return room.save()
  } else {
    return {
      code: 404,
      message: 'room not found'
    };
  }
};

       const deleteRoom = async (id) => {
  if (mongoose.Types.ObjectId.isValid(id) === false) {
    return {
      code: 422,
      message: 'invalid room id'
    };
  }
  return Room.findOneAndDelete({
    _id: id
  })
};